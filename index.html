<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Graph RAG - Interactive Knowledge Graph Prototype</title>
  <link rel="stylesheet" href="style.css" />
  <script src="https://d3js.org/d3.v7.min.js"></script>
</head>
<body>
  <!-- Background Grid -->
  <div class="bg-grid"></div>

  <!-- Top Bar -->
  <header class="topbar">
    <div class="topbar-left">
      <div class="logo">
        <svg width="28" height="28" viewBox="0 0 28 28" fill="none">
          <circle cx="14" cy="14" r="12" stroke="#4a9eff" stroke-width="2" fill="none"/>
          <circle cx="9" cy="11" r="3" fill="#4a9eff"/>
          <circle cx="19" cy="11" r="3" fill="#34d399"/>
          <circle cx="14" cy="20" r="3" fill="#f87171"/>
          <line x1="11" y1="12" x2="17" y2="12" stroke="#666" stroke-width="1.5"/>
          <line x1="10" y1="13" x2="13" y2="19" stroke="#666" stroke-width="1.5"/>
          <line x1="18" y1="13" x2="15" y2="19" stroke="#666" stroke-width="1.5"/>
        </svg>
        <h1>Graph RAG</h1>
        <span class="badge">Prototype</span>
      </div>
    </div>
    <div class="topbar-right">
      <button class="btn btn-ghost" id="themeToggle" title="Toggle Theme">
        <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><circle cx="12" cy="12" r="5"/><path d="M12 1v2M12 21v2M4.22 4.22l1.42 1.42M18.36 18.36l1.42 1.42M1 12h2M21 12h2M4.22 19.78l1.42-1.42M18.36 5.64l1.42-1.42"/></svg>
      </button>
      <button class="btn btn-primary" id="presentationToggle">
        <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><rect x="2" y="3" width="20" height="14" rx="2"/><path d="M8 21h8M12 17v4"/></svg>
        Presentation Mode
      </button>
    </div>
  </header>

  <!-- Main Three-Panel Layout -->
  <main class="main-layout">

    <!-- ============ LEFT PANEL ============ -->
    <section class="panel panel-left" id="panelLeft">
      <div class="panel-header">
        <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M14 2H6a2 2 0 00-2 2v16a2 2 0 002 2h12a2 2 0 002-2V8z"/><polyline points="14 2 14 8 20 8"/></svg>
        <h2>Document Upload & Chunking</h2>
      </div>
      <div class="panel-body">
        <!-- Hidden file input -->
        <input type="file" id="fileInput" accept=".pdf,.txt,.doc,.docx,.csv,.json" style="display:none" />
        <!-- Upload Area -->
        <div class="upload-area" id="uploadArea">
          <div class="upload-icon">
            <svg width="48" height="48" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5"><path d="M21 15v4a2 2 0 01-2 2H5a2 2 0 01-2-2v-4"/><polyline points="17 8 12 3 7 8"/><line x1="12" y1="3" x2="12" y2="15"/></svg>
          </div>
          <p class="upload-text">Drop a file here or click to upload</p>
          <p class="upload-subtext">Supports PDF, TXT, DOC, CSV, JSON</p>
          <button class="btn btn-primary upload-btn" id="uploadBtn">
            <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M21 15v4a2 2 0 01-2 2H5a2 2 0 01-2-2v-4"/><polyline points="17 8 12 3 7 8"/><line x1="12" y1="3" x2="12" y2="15"/></svg>
            Choose File
          </button>
        </div>

        <!-- File Info (hidden initially) -->
        <div class="file-info hidden" id="fileInfo">
          <div class="file-card">
            <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="#f87171" stroke-width="2"><path d="M14 2H6a2 2 0 00-2 2v16a2 2 0 002 2h12a2 2 0 002-2V8z"/><polyline points="14 2 14 8 20 8"/></svg>
            <div class="file-meta">
              <span class="file-name" id="fileName">document.pdf</span>
              <span class="file-size" id="fileSizeText">0 KB · 7 chunks extracted</span>
            </div>
            <div class="file-status">
              <span class="status-dot"></span> Processed
            </div>
          </div>
        </div>

        <!-- Processing Animation -->
        <div class="processing hidden" id="processing">
          <div class="processing-bar">
            <div class="processing-fill" id="processingFill"></div>
          </div>
          <p class="processing-text" id="processingText">Extracting text...</p>
        </div>

        <!-- Chunks List -->
        <div class="chunks-container hidden" id="chunksContainer">
          <div class="chunks-header">
            <h3>Extracted Chunks</h3>
            <span class="chunk-count" id="chunkCount">0 chunks</span>
          </div>
          <div class="chunks-list" id="chunksList"></div>
        </div>
      </div>
    </section>

    <!-- ============ MIDDLE PANEL ============ -->
    <section class="panel panel-middle" id="panelMiddle">
      <div class="panel-header">
        <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><circle cx="12" cy="12" r="3"/><circle cx="4" cy="6" r="2"/><circle cx="20" cy="6" r="2"/><circle cx="4" cy="18" r="2"/><circle cx="20" cy="18" r="2"/><line x1="6" y1="7" x2="10" y2="10"/><line x1="18" y1="7" x2="14" y2="10"/><line x1="6" y1="17" x2="10" y2="14"/><line x1="18" y1="17" x2="14" y2="14"/></svg>
        <h2>Extracted Knowledge Graph</h2>
      </div>
      <div class="panel-body graph-body">
        <!-- Graph Legend -->
        <div class="graph-legend">
          <div class="legend-item"><span class="legend-dot" style="background:#4a9eff"></span>Doctor</div>
          <div class="legend-item"><span class="legend-dot" style="background:#34d399"></span>Department</div>
          <div class="legend-item"><span class="legend-dot" style="background:#f87171"></span>Disease</div>
          <div class="legend-item"><span class="legend-dot" style="background:#fbbf24"></span>City</div>
        </div>
        <!-- Graph Controls -->
        <div class="graph-controls">
          <button class="btn btn-sm btn-ghost" id="graphZoomIn" title="Zoom In">
            <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><circle cx="11" cy="11" r="8"/><line x1="21" y1="21" x2="16.65" y2="16.65"/><line x1="11" y1="8" x2="11" y2="14"/><line x1="8" y1="11" x2="14" y2="11"/></svg>
          </button>
          <button class="btn btn-sm btn-ghost" id="graphZoomOut" title="Zoom Out">
            <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><circle cx="11" cy="11" r="8"/><line x1="21" y1="21" x2="16.65" y2="16.65"/><line x1="8" y1="11" x2="14" y2="11"/></svg>
          </button>
          <button class="btn btn-sm btn-ghost" id="graphReset" title="Reset View">
            <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><polyline points="1 4 1 10 7 10"/><path d="M3.51 15a9 9 0 102.13-9.36L1 10"/></svg>
          </button>
        </div>
        <!-- D3 Graph SVG -->
        <div class="graph-container" id="graphContainer">
          <!-- Empty state placeholder -->
          <div class="graph-placeholder" id="graphPlaceholder">
            <svg width="56" height="56" viewBox="0 0 24 24" fill="none" stroke="var(--text-muted)" stroke-width="1" opacity="0.4">
              <circle cx="12" cy="12" r="3"/><circle cx="4" cy="6" r="2"/><circle cx="20" cy="6" r="2"/><circle cx="4" cy="18" r="2"/><circle cx="20" cy="18" r="2"/>
              <line x1="6" y1="7" x2="10" y2="10"/><line x1="18" y1="7" x2="14" y2="10"/><line x1="6" y1="17" x2="10" y2="14"/><line x1="18" y1="17" x2="14" y2="14"/>
            </svg>
            <p>Upload a document to extract</p>
            <p>the knowledge graph</p>
          </div>
          <svg id="graphSvg"></svg>
        </div>
        <!-- Build progress -->
        <div class="graph-build-status hidden" id="graphBuildStatus">
          <div class="build-spinner"></div>
          <span id="graphBuildText">Extracting entities...</span>
        </div>
        <!-- Tooltip -->
        <div class="graph-tooltip hidden" id="graphTooltip"></div>
        <!-- Node count -->
        <div class="graph-stats">
          <span id="nodeCount">0 nodes</span> · <span id="edgeCount">0 relationships</span>
        </div>
      </div>
    </section>

    <!-- ============ RIGHT PANEL ============ -->
    <section class="panel panel-right" id="panelRight">
      <div class="panel-header">
        <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><polyline points="22 12 18 12 15 21 9 3 6 12 2 12"/></svg>
        <h2>Graph RAG Pipeline</h2>
      </div>
      <div class="panel-body">
        <!-- Query Input -->
        <div class="query-section">
          <label class="query-label">Ask a Question</label>
          <div class="query-input-wrapper">
            <input type="text" class="query-input" id="queryInput" placeholder="Which doctor treats heart problems in Chennai?" />
            <button class="btn btn-primary query-btn" id="queryBtn">
              <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><line x1="22" y1="2" x2="11" y2="13"/><polygon points="22 2 15 22 11 13 2 9 22 2"/></svg>
            </button>
          </div>
          <div class="query-suggestions">
            <button class="suggestion-chip" data-query="Which doctor treats heart problems in Chennai?">Heart doctor in Chennai?</button>
            <button class="suggestion-chip" data-query="Who treats epilepsy in Bangalore?">Epilepsy in Bangalore?</button>
            <button class="suggestion-chip" data-query="Which doctor treats cancer in Mumbai?">Cancer doctor in Mumbai?</button>
            <button class="suggestion-chip" data-query="Who treats arthritis in Delhi?">Arthritis in Delhi?</button>
          </div>
        </div>

        <!-- Pipeline Visualization -->
        <div class="pipeline-container hidden" id="pipelineContainer">
          <!-- Step 1: User Question -->
          <div class="pipeline-step" id="step-question" data-step="1">
            <div class="step-indicator">
              <div class="step-dot"></div>
              <div class="step-line"></div>
            </div>
            <div class="step-content">
              <div class="step-header">
                <span class="step-number">01</span>
                <span class="step-title">User Question</span>
              </div>
              <div class="step-body" id="stepQuestion"></div>
            </div>
          </div>

          <!-- Step 2: LLM Understanding -->
          <div class="pipeline-step" id="step-understanding" data-step="2">
            <div class="step-indicator">
              <div class="step-dot"></div>
              <div class="step-line"></div>
            </div>
            <div class="step-content">
              <div class="step-header">
                <span class="step-number">02</span>
                <span class="step-title">LLM Understanding</span>
              </div>
              <div class="step-body" id="stepUnderstanding"></div>
            </div>
          </div>

          <!-- Step 3: Query Translator -->
          <div class="pipeline-step" id="step-translator" data-step="3">
            <div class="step-indicator">
              <div class="step-dot"></div>
              <div class="step-line"></div>
            </div>
            <div class="step-content">
              <div class="step-header">
                <span class="step-number">03</span>
                <span class="step-title">Query Translator</span>
              </div>
              <div class="step-body" id="stepTranslator"></div>
            </div>
          </div>

          <!-- Step 4: Graph Query -->
          <div class="pipeline-step" id="step-cypher" data-step="4">
            <div class="step-indicator">
              <div class="step-dot"></div>
              <div class="step-line"></div>
            </div>
            <div class="step-content">
              <div class="step-header">
                <span class="step-number">04</span>
                <span class="step-title">Graph Query (Cypher)</span>
              </div>
              <div class="step-body" id="stepCypher"></div>
            </div>
          </div>

          <!-- Step 5: Retrieved Context -->
          <div class="pipeline-step" id="step-context" data-step="5">
            <div class="step-indicator">
              <div class="step-dot"></div>
              <div class="step-line"></div>
            </div>
            <div class="step-content">
              <div class="step-header">
                <span class="step-number">05</span>
                <span class="step-title">Retrieved Context</span>
              </div>
              <div class="step-body" id="stepContext"></div>
            </div>
          </div>

          <!-- Step 6: LLM Generation -->
          <div class="pipeline-step" id="step-generation" data-step="6">
            <div class="step-indicator">
              <div class="step-dot"></div>
              <div class="step-line"></div>
            </div>
            <div class="step-content">
              <div class="step-header">
                <span class="step-number">06</span>
                <span class="step-title">LLM Generation</span>
              </div>
              <div class="step-body" id="stepGeneration"></div>
            </div>
          </div>

          <!-- Step 7: Final Answer -->
          <div class="pipeline-step" id="step-answer" data-step="7">
            <div class="step-indicator">
              <div class="step-dot"></div>
            </div>
            <div class="step-content">
              <div class="step-header">
                <span class="step-number">07</span>
                <span class="step-title">Final Answer</span>
              </div>
              <div class="step-body" id="stepAnswer"></div>
            </div>
          </div>
        </div>
      </div>
    </section>
  </main>

  <!-- Embedding Modal -->
  <div class="modal-overlay hidden" id="embeddingModal">
    <div class="modal">
      <div class="modal-header">
        <h3>Embedding Visualization</h3>
        <button class="btn btn-ghost modal-close" id="modalClose">&times;</button>
      </div>
      <div class="modal-body">
        <div class="embedding-info" id="embeddingInfo"></div>
        <div class="embedding-chart" id="embeddingChart"></div>
        <div class="embedding-vector" id="embeddingVector"></div>
      </div>
    </div>
  </div>

  <!-- Presentation Mode Overlay -->
  <div class="presentation-overlay hidden" id="presentationOverlay">
    <div class="presentation-content">
      <div class="presentation-header">
        <h2 id="presTitle">Graph RAG Pipeline</h2>
        <button class="btn btn-ghost" id="presClose">&times;</button>
      </div>
      <div class="presentation-body">
        <div class="pres-step-indicator" id="presStepIndicator"></div>
        <div class="pres-main" id="presMain">
          <h3 id="presStepTitle"></h3>
          <p id="presStepDescription"></p>
          <div class="pres-visual" id="presVisual"></div>
        </div>
      </div>
      <div class="presentation-footer">
        <button class="btn btn-ghost" id="presPrev">
          <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><polyline points="15 18 9 12 15 6"/></svg>
          Previous
        </button>
        <span class="pres-counter" id="presCounter">1 / 6</span>
        <button class="btn btn-primary" id="presNext">
          Next
          <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><polyline points="9 18 15 12 9 6"/></svg>
        </button>
      </div>
    </div>
  </div>

  <!-- Footer -->
  <footer class="footer">
    <p>Interactive Graph RAG Prototype — Multi-hop Reasoning Demo</p>
  </footer>

  <!-- Scripts -->
  <script src="data.js"></script>
  <script src="graph.js"></script>
  <script src="presentation.js"></script>
  <script src="app.js"></script>
</body>
</html>
